
<!--ID нужно делать как GUID'ы, иначе перекрываются!!!!-->

<div id="xx56b79ce1-cd7a-48b5-99e7-7493b89b87b2" style="height:400px">
    <h4>catalog/customers Data grid</h4>
    <div>
        <button @click.stop.prevent="Customers.$append()">Add</button>
        <button @click.stop.prevent="Customers.$append()">Add in dialog</button>
        <label v-text="Customers.length"></label>
        <button @click.stop.prevent="$showDialog">Show Dialog</button>
    </div>
    <data-grid :items-source="Customers" :striped="true" :bordered="true" :hover="true">
        <data-grid-column header="Id" content="Id"></data-grid-column>
        <data-grid-column header="Name" content="Name"></data-grid-column>
        <data-grid-column header="Amount" content="Amount" align="right"></data-grid-column>
        <data-grid-column id="cmd"></data-grid-column>
        <template slot="cmd" scope="cell">
            <button @click.stop.prevent="$edit(cell.row)">
                <i class="fa fa-edit"></i>
            </button>
            <button @click.stop.prevent="cell.row.$remove()">
                <i class="fa fa-trash"></i>
            </button>
        </template>
    </data-grid>
</div>

<script type="text/javascript">
    (function () {

        const cmn = require('datamodel');
        const bus = require('eventBus');

        // ctor
        function TCustomer(source, path, parent) {
            cmn.createObject(this, source, path, parent);
        }

        // metadata
        cmn.defineObject(TCustomer, {
            Id: Number,
            Name: String,
            Amount: Number
        }, /* array item */ true);

        function TCustomerArray(source, path, parent) {
            return cmn.createArray(source, path, TCustomer, TCustomerArray, parent);
        }

        function TRoot(source) {
            cmn.createObject(this, source, '', this);
        }

        cmn.defineObject(TRoot, {
            Customers: TCustomerArray,
        });
        const ctors = {
            TCustomer,
            TCustomerArray,
            TRoot
        };

        const template = {
        };

        const modelData = {
            Customers: [
                { Id: 123, Name: "First customer", Amount: 150 },
                { Id: 247, Name: "Second customer", Amount: 300 },
            ]
        };


        cmn.implementRoot(TRoot, template, ctors);
        const reactiveData = new TRoot(modelData);

        Vue.component('a2-modal', {
            template: '<div class="modal-wrapper"><div>'
        });

        new Vue({
            el: "#xx56b79ce1-cd7a-48b5-99e7-7493b89b87b2",
            data: reactiveData,
            methods: {
                $edit(item) {
                    //alert(item.Name);
                    window.history.pushState(null, 'edit', '/catalog/customers/edit/' + item.Id);
                    bus.$emit('route');
                },
                $showDialog() {
                    var dat = { x: 5, y: 10, promise:null };
                    var x = bus.$emit('modal', 'dialogName', dat);
                    dat.promise.then(function (result) {
                        alert('then:' + result);
                    })
                    alert('resturs:' + dat.promise);
                    //alert('show dialog');
                    //let elem = document.createElement('a2-modal');
                    //document.body.appendChild(elem);
                }
            }
        });
    })();
</script>


