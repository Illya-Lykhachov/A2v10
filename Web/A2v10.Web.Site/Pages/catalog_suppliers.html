
<!--ID нужно делать как GUID'ы, иначе перекрываются!!!!-->

<div id="catalog-suppliers-index" style="min-height:400px">
    <h4>catalog/suppliers Data grid</h4>
    <div>
        <button @click.stop.prevent="Customers.$append()">Add</button>
        <button @click.stop.prevent="Customers.$append()">Add in dialog</button>
        <label v-text="Customers.length"></label>
        <button @click.stop.prevent="$showDialog">Show Dialog</button>
    </div>
    <div style="width:200px">
        <textbox :item="Customers[0]" prop="Name"></textbox>
    </div>
    <data-grid :items-source="Customers" :striped="true" :bordered="true" :hover="true">
        <data-grid-column header="Id" content="Id"></data-grid-column>
        <data-grid-column header="Name" content="Name" :editable="true"></data-grid-column>
        <data-grid-column header="Amount" content="Amount" align="right"></data-grid-column>
        <data-grid-column id="cmd"></data-grid-column>
        <template slot="cmd" scope="cell">
            <button @click.stop.prevent="$edit(cell.row)">
                <i class="fa fa-edit"></i>
            </button>
            <button @click.stop.prevent="cell.row.$remove()">
                <i class="fa fa-trash"></i>
            </button>
        </template>
    </data-grid>
    <div>
        <button @click.stop.prevent="$closeModal('ok')">OK</button>
        <button @click.stop.prevent="$closeModal('cancel')">Cancel</button>
    </div>
</div>

<script type="text/javascript">
    (function () {

        const cmn = require('datamodel');
        const bus = require('eventBus');

        // ctor
        function TCustomer(source, path, parent) {
            cmn.createObject(this, source, path, parent);
        }

        // metadata
        cmn.defineObject(TCustomer, {
            Id: Number,
            Name: String,
            Amount: Number
        }, /* array item */ true);

        function TCustomerArray(source, path, parent) {
            return cmn.createArray(source, path, TCustomer, TCustomerArray, parent);
        }

        function TRoot(source) {
            cmn.createObject(this, source, '', this);
        }

        cmn.defineObject(TRoot, {
            Customers: TCustomerArray,
        });
        const ctors = {
            TCustomer,
            TCustomerArray,
            TRoot
        };

        const template = {
        };

        const modelData = {
            Customers: [
                { Id: 123, Name: "First supplier", Amount: 150 },
                { Id: 247, Name: "Second supplier", Amount: 300 },
            ]
        };


        cmn.implementRoot(TRoot, template, ctors);
        const reactiveData = new TRoot(modelData);

        new Vue({
            el: "#catalog-suppliers-index",
            data: reactiveData,
            destroyed() {
                alert('suppliers destroyed');
            },
            methods: {
                $edit(item) {
                    //alert(item.Name);
                    window.history.pushState(null, 'edit', '/catalog/customers/edit/' + item.Id);
                    bus.$emit('route');
                },
                $showDialog() {
                    var x = bus.$emit('modal', 'dialogName', {x:234, y:88});
                },
                $closeModal(result) {
                    bus.$emit('modalClose', result);
                }
            }
        });
    })();
</script>


